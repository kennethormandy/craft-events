!function($){void 0===Craft.Events&&(Craft.Events={});var t="verbb\\events\\elements\\Event";Craft.Events.EventIndex=Craft.BaseElementIndex.extend({editableEventTypes:null,$newEventBtnEventType:null,$newEventBtn:null,init:function(t,e,n){this.on("selectSource",$.proxy(this,"updateButton")),this.on("selectSite",$.proxy(this,"updateButton")),this.base(t,e,n)},afterInit:function(){this.editableEventTypes=[],Craft.Events.editableEventTypes||(Craft.Events.editableEventTypes=[]);for(var t=0;t<Craft.Events.editableEventTypes.length;t++){var e=Craft.Events.editableEventTypes[t];this.getSourceByKey("eventType:"+e.id)&&this.editableEventTypes.push(e)}this.base()},getDefaultSourceKey:function(){if("index"===this.settings.context&&"undefined"!=typeof defaultEventTypeHandle)for(var t=0;t<this.$sources.length;t++){var e=$(this.$sources[t]);if(e.data("handle")===defaultEventTypeHandle)return e.data("key")}return this.base()},updateButton:function(){if(this.$source){var t=this.$source.data("handle"),e,n,i;if(this.editableEventTypes.length){var s,a;if(this.$newEventBtnEventType&&this.$newEventBtnEventType.remove(),t)for(e=0;e<this.editableEventTypes.length;e++)if(this.editableEventTypes[e].handle===t){s=this.editableEventTypes[e];break}if(this.$newEventBtnEventType=$('<div class="btngroup submit"/>'),s?(n=this._getEventTypeTriggerHref(s),i="index"===this.settings.context?Craft.t("events","New event"):Craft.t("events","New {eventType} event",{eventType:s.name}),this.$newEventBtn=$('<a class="btn submit add icon" '+n+">"+Craft.escapeHtml(i)+"</a>").appendTo(this.$newEventBtnEventType),"index"!==this.settings.context&&this.addListener(this.$newEventBtn,"click",(function(t){this._openCreateEventModal(t.currentTarget.getAttribute("data-id"))})),this.editableEventTypes.length>1&&(a=$('<div class="btn submit menubtn"></div>').appendTo(this.$newEventBtnEventType))):this.$newEventBtn=a=$('<div class="btn submit add icon menubtn">'+Craft.t("events","New event")+"</div>").appendTo(this.$newEventBtnEventType),a){for(var r='<div class="menu"><ul>',e=0;e<this.editableEventTypes.length;e++){var l=this.editableEventTypes[e];"index"!==this.settings.context&&l===s||(n=this._getEventTypeTriggerHref(l),i="index"===this.settings.context?l.name:Craft.t("events","New {eventType} event",{eventType:l.name}),r+="<li><a "+n+'">'+Craft.escapeHtml(i)+"</a></li>")}$(r+="</ul></div>").appendTo(this.$newEventBtnEventType);var d=new Garnish.MenuBtn(a);"index"!==this.settings.context&&d.on("optionSelect",$.proxy((function(t){this._openCreateEventModal(t.option.getAttribute("data-id"))}),this))}this.addButton(this.$newEventBtnEventType)}if("index"===this.settings.context&&"undefined"!=typeof history){var h="events/events";t&&(h+="/"+t),history.replaceState({},"",Craft.getUrl(h))}}},_getEventTypeTriggerHref:function(t){if("index"===this.settings.context){var e="events/events/"+t.handle+"/new";if(this.siteId&&this.siteId!=Craft.primarySiteId)for(var n=0;n<Craft.sites.length;n++)Craft.sites[n].id==this.siteId&&(e+="/"+Craft.sites[n].handle);return'href="'+Craft.getUrl(e)+'"'}return'data-id="'+t.id+'"'},_openCreateEventModal:function(e){if(!this.$newEventBtn.hasClass("loading")){for(var n,i=0;i<this.editableEventTypes.length;i++)if(this.editableEventTypes[i].id===e){n=this.editableEventTypes[i];break}if(n){this.$newEventBtn.addClass("inactive");var s=this.$newEventBtn.text();this.$newEventBtn.text(Craft.t("events","New {eventType} event",{eventType:n.name})),new Craft.ElementEditor({hudTrigger:this.$newEventBtnGroup,elementType:t,siteId:this.siteId,attributes:{typeId:e},onBeginLoading:$.proxy((function(){this.$newEventBtn.addClass("loading")}),this),onEndLoading:$.proxy((function(){this.$newEventBtn.removeClass("loading")}),this),onHideHud:$.proxy((function(){this.$newEventBtn.removeClass("inactive").text(s)}),this),onSaveElement:$.proxy((function(t){var n="eventType:"+e;this.sourceKey!==n&&this.selectSourceByKey(n),this.selectElementAfterUpdate(t.id),this.updateElements()}),this)})}}}}),Craft.registerElementIndexClass(t,Craft.Events.EventIndex)}(jQuery),function($){void 0===Craft.Events&&(Craft.Events={}),Craft.Events.EventEdit=Garnish.Base.extend({$container:null,currentStartTime:null,currentEndTime:null,$startDate:null,$startTime:null,$endDate:null,$endTime:null,$allDay:null,init:function(t){this.$container=$("#"+t),this.$startDate=this.$container.find('[name="startDate[date]"]'),this.$startTime=this.$container.find('[name="startDate[time]"]'),this.$endDate=this.$container.find('[name="endDate[date]"]'),this.$endTime=this.$container.find('[name="endDate[time]"]'),this.$allDay=this.$container.find("#allDay-field .lightswitch"),this.$allDay.hasClass("on")&&this.checkAllDay(),this.addListener(this.$allDay,"change","checkAllDay"),this.addListener(this.$startDate,"change","updateEndDate"),this.addListener(this.$endDate,"change","updateStartDate")},checkAllDay:function(){this.$allDay.hasClass("on")?this.hideTime():this.showTime()},hideTime:function(){this.$startTime.addClass("disabled"),this.$startTime.prop("disabled",!0),this.currentStartTime=this.$startTime.val(),this.$startTime.val("12:00 AM"),this.$endTime.addClass("disabled"),this.$endTime.prop("disabled",!0),this.currentEndTime=this.$endTime.val(),this.$endTime.val("12:00 AM")},showTime:function(){this.$startTime.removeClass("disabled"),this.$startTime.prop("disabled",!1),this.$startTime.val(this.currentStartTime),this.$endTime.removeClass("disabled"),this.$endTime.prop("disabled",!1),this.$endTime.val(this.currentEndTime)},updateEndDate:function(){var t=this.$startDate.val(),e=this.$endDate.val();(Date.parse(t)>Date.parse(e)||""===e)&&this.$endDate.val(this.$startDate.val())},updateStartDate:function(){var t=this.$startDate.val(),e=this.$endDate.val();(Date.parse(e)<Date.parse(t)||""===t)&&this.$startDate.val(this.$endDate.val())}})}(jQuery),function($){void 0===Craft.Events&&(Craft.Events={});var t="verbb\\events\\elements\\Ticket";Craft.Events.TicketIndex=Craft.BaseElementIndex.extend({afterInit:function(){var t='href="'+Craft.getUrl("events/tickets/new")+'"',e=Craft.t("events","New ticket");this.$newEventBtnGroup=$('<div class="btngroup submit"/>'),this.$newEventBtn=$('<a class="btn submit add icon" '+t+">"+e+"</a>").appendTo(this.$newEventBtnGroup),this.addButton(this.$newEventBtnGroup),this.base()}});try{Craft.registerElementIndexClass(t,Craft.Events.TicketIndex)}catch(t){}}(jQuery),function($){void 0===Craft.Events&&(Craft.Events={}),Craft.Events.TicketEdit=Garnish.Base.extend({rowHtml:"",tickets:null,ticketTypeHtml:"",totalNewRows:0,$container:null,$ticketContainer:null,$ticketRows:null,$addBtn:null,$capacity:null,$quantity:null,currentStartTime:null,currentEndTime:null,$startDate:null,$startTime:null,$endDate:null,$endTime:null,$allDay:null,init:function(t,e,n,i){this.rowHtml=n,this.tickets=e,this.ticketTypeHtml=i,this.$container=$("#"+t),this.$ticketContainer=this.$container.find(".create-tickets-container"),this.$ticketRows=this.$ticketContainer.find(".create-tickets"),this.$addBtn=this.$container.find(".add-ticket"),this.$capacity=this.$container.find("#capacity"),this.$quantity=this.$container.find(".ticket-quantity");for(var s=0;s<this.$ticketRows.length;s++){var t=$(this.$ticketRows[s]).data("id");new Craft.Events.TicketEditRow(this,this.$ticketRows[s],s);var a="string"==typeof t&&t.match(/new(\d+)/);a&&a[1]>this.totalNewRows&&(this.totalNewRows=parseInt(a[1]))}this.addListener(this.$addBtn,"click","addTicket"),this.addListener(this.$quantity,"change","sumAllQuantities")},addTicket:function(){this.totalNewRows++;var t="new"+this.totalNewRows,e=this.getParsedBlockHtml(this.rowHtml.bodyHtml,t),n=this.getParsedBlockHtml(this.rowHtml.footHtml,t),i=$(e).appendTo(this.$ticketContainer);Garnish.$bod.append(n),Craft.initUiElements(i),new Craft.Events.TicketEditRow(this,i,t)},getParsedBlockHtml:function(t,e){return"string"==typeof t?t.replace(/__ROWID__/g,e):""},sumAllQuantities:function(){var t=0;$.each($("body").find(".ticket-quantity"),(function(){t+=Number($(this).val())})),""==this.$capacity.val()&&this.$capacity.val(t)}}),Craft.Events.TicketEditRow=Garnish.Base.extend({id:null,editContainer:null,$container:null,$settingsContainer:null,$ticketTypeFields:null,$settingsBtn:null,$deleteBtn:null,$capacity:null,$quantity:null,init:function(t,e,n){this.id=n,this.editContainer=t,this.$container=$(e),this.$settingsContainer=this.$container.find(".create-tickets-settings"),this.$ticketTypeFields=this.$container.find(".ticket-type-fields"),this.$elementSelect=this.$container.find(".elementselect"),this.$settingsBtn=this.$container.find(".settings.icon"),this.$deleteBtn=this.$container.find(".delete.icon.button"),this.$capacity=$("body").find("#capacity"),this.$quantity=this.$container.find(".ticket-quantity"),Garnish.requestAnimationFrame($.proxy((function(){var t=this.$elementSelect.data("elementSelect");t.settings.onSelectElements=$.proxy(this,"onSelectElements"),t.settings.onRemoveElements=$.proxy(this,"onRemoveElements")}),this)),this.addListener(this.$settingsBtn,"click","settingsRow"),this.addListener(this.$deleteBtn,"click","deleteRow"),this.addListener(this.$quantity,"change","sumAllQuantities")},onSelectElements:function(t){var e=t[0].id,n=this.editContainer.ticketTypeHtml[e],i="new"+this.editContainer.totalNewRows;if(this.id){var s=this.editContainer.tickets[this.id];s&&(i=s.id)}var a=this.getParsedBlockHtml(n.bodyHtml,i),r=this.getParsedBlockHtml(n.footHtml,i),l=this.$ticketTypeFields.html(a);Garnish.$bod.append(r),Craft.initUiElements(l)},onRemoveElements:function(){this.$ticketTypeFields.html("")},settingsRow:function(){this.$settingsContainer.is(":visible")?(this.$settingsBtn.removeClass("active"),this.$settingsContainer.velocity("slideUp")):(this.$settingsBtn.addClass("active"),this.$settingsContainer.velocity("slideDown"))},deleteRow:function(){var t;confirm(Craft.t("events","Are you sure you want to delete this ticket type?"))&&(this.$container.remove(),this.sumAllQuantities())},sumAllQuantities:function(){var t=0;$.each($("body").find(".ticket-quantity"),(function(){t+=Number($(this).val())})),""==this.$capacity.val()&&this.$capacity.val(t)},getParsedBlockHtml:function(t,e){return"string"==typeof t?t.replace(/__ROWID__/g,e):""}})}(jQuery),void 0===Craft.Events&&(Craft.Events={}),jQuery;
//# sourceMappingURL=events.js.map