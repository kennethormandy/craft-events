!function($){void 0===Craft.Events&&(Craft.Events={}),Craft.Events.EventIndex=Craft.BaseElementIndex.extend({editableEventTypes:null,$newEventBtnEventType:null,$newEventBtn:null,init:function(e,t,n){this.on("selectSource",$.proxy(this,"updateButton")),this.on("selectSite",$.proxy(this,"updateButton")),this.base(e,t,n)},afterInit:function(){this.editableEventTypes=[];for(const e of Craft.Events.editableEventTypes)this.getSourceByKey("eventType:"+e.uid)&&this.editableEventTypes.push(e);this.base()},getDefaultSourceKey:function(){if("index"===this.settings.context&&"undefined"!=typeof defaultEventTypeHandle)for(var e=0;e<this.$sources.length;e++){var t=$(this.$sources[e]);if(t.data("handle")===defaultEventTypeHandle)return t.data("key")}return this.base()},updateButton:function(){if(!this.$source)return;const e=this.$source.data("handle");if(this.editableEventTypes.length){this.$newEventBtnGroup&&this.$newEventBtnGroup.remove();const t=this.editableEventTypes.find((t=>t.handle===e));let n;this.$newEventBtnGroup=$('<div class="btngroup submit" data-wrapper/>');const s=`new-event-menu-${Craft.randomString(10)}`;if(t){const e="index"===this.settings.context?Craft.t("events","New event"):Craft.t("events","New {eventType} event",{eventType:t.name}),i="index"===this.settings.context?Craft.t("events","New {eventType} event",{eventType:t.name}):e,a="index"===this.settings.context?"link":null;this.$newEventBtn=Craft.ui.createButton({label:e,ariaLabel:i,spinner:!0,role:a}).addClass("submit add icon").appendTo(this.$newEventBtnGroup),this.addListener(this.$newEventBtn,"click mousedown",(e=>{"index"===this.settings.context&&("click"===e.type&&Garnish.isCtrlKeyPressed(e)||"mousedown"===e.type&&1===e.originalEvent.button)?window.open(Craft.getUrl(`events/events/${eventType.handle}/new`)):"click"===e.type&&this._createEvent(t.id)})),this.editableEventTypes.length>1&&(n=$("<button/>",{type:"button",class:"btn submit menubtn btngroup-btn-last","aria-controls":s,"data-disclosure-trigger":"","aria-label":Craft.t("events","New event, choose a type")}).appendTo(this.$newEventBtnGroup))}else this.$newEventBtn=n=Craft.ui.createButton({label:Craft.t("app","New event"),ariaLabel:Craft.t("app","New event, choose a type"),spinner:!0}).addClass("submit add icon menubtn btngroup-btn-last").attr("aria-controls",s).attr("data-disclosure-trigger","").appendTo(this.$newEventBtnGroup);if(this.addButton(this.$newEventBtnGroup),n){const e=$("<div/>",{id:s,class:"menu menu--disclosure"}).appendTo(this.$newEventBtnGroup),i=$("<ul/>").appendTo(e);for(const e of this.editableEventTypes){const s="index"===this.settings.context?"link":"button";if("index"===this.settings.context||e!==t){const t=$("<li/>").appendTo(i),a=$("<a/>",{role:"button"===s?"button":null,href:Craft.getUrl(`events/events/${e.handle}/new`),type:"button"===s?"button":null,text:Craft.t("events","New {eventType} event",{eventType:e.name})}).appendTo(t);this.addListener(a,"activate",(()=>{n.data("trigger").hide(),this._createEvent(e.id)})),"button"===s&&this.addListener(a,"keydown",(t=>{t.keyCode===Garnish.SPACE_KEY&&(t.preventDefault(),n.data("trigger").hide(),this._createEvent(e.id))}))}}new Garnish.DisclosureMenu(n)}}if("index"===this.settings.context){var t="events/events";e&&(t+="/"+e),Craft.setPath(t)}},_createEvent:function(e){if(this.$newEventBtn.hasClass("loading"))return void console.warn("New event creation already in progress.");const t=this.editableEventTypes.find((t=>t.id===e));if(!t)throw`Invalid event type ID: ${e}`;this.$newEventBtn.addClass("loading"),Craft.sendActionRequest("POST","events/events/create",{data:{siteId:this.siteId,eventType:t.handle}}).then((({data:e})=>{if("index"===this.settings.context)document.location.href=Craft.getUrl(e.cpEditUrl,{fresh:1});else{const t=undefined;Craft.createElementEditor(this.elementType,{siteId:this.siteId,elementId:e.event.id,draftId:e.event.draftId,params:{fresh:1}}).on("submit",(()=>{this.clearSearch(),this.setSelectedSortAttribute("dateCreated","desc"),this.selectElementAfterUpdate(e.event.id),this.updateElements()}))}})).finally((()=>{this.$newEventBtn.removeClass("loading")}))}}),Craft.registerElementIndexClass("verbb\\events\\elements\\Event",Craft.Events.EventIndex)}(jQuery);
//# sourceMappingURL=event-index.js.map